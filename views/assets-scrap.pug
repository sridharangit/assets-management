extends layout

block content
  .p-4
    .card.shadow-sm.rounded-4.p-3
      h4.fw-bold.text-dark
        | Scrap Asset

      div#alertBox.alert.mb-3.mt-3(style="display:none")

      form#scrapForm
        .row.mb-3
          .col-md-6
            label.form-label Asset *
            select#asset.form-select(required)
              option(value="" disabled selected) Select Asset
              each a in assets
                option(value=a.asset_id) #{a.c_serial} â€” #{a.c_type} (#{a.c_branch})

          .col-md-6
            label.form-label Reason *
            input#reason.form-control(type="text" required placeholder="Eg: Broken, Obsolete")

        button.btn.btn-danger.mt-3(type="submit")
          i.fa.fa-ban.me-2
          | Mark as Scrap

  script.
    document.addEventListener("DOMContentLoaded", ()=>{
      const form = document.getElementById('scrapForm');
      const alertBox = document.getElementById('alertBox');
      const employee = document.getElementById('employee');
      const asset = document.getElementById('asset');
      const reason = document.getElementById('reason');

      function showMessage(msg, ok=true){
        alertBox.style.display='block';
        alertBox.innerText = msg;
        alertBox.className = ok?'alert alert-success':'alert alert-danger';
      }

      form.addEventListener('submit', e=>{
        e.preventDefault();
        const ast = asset.value;
        const r   = reason.value.trim();

        if(!ast || !r){
          showMessage('All fields required!', false);
          return;
        }

        fetch('/assets/scrap',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ asset_id: ast, reason: r })
        })
        .then(r=>r.json())
        .then(d=>{
          if(d.success){
            showMessage('Asset scrapped successfully!', true);
            setTimeout(()=>location.reload(), 1000);
          } else showMessage('Error: ' + d.error, false);
        })
        .catch(()=>showMessage('Server error', false));
      });
    });
