extends layout
block content
  .p-4
    .card.p-3.rounded-4.shadow-sm
      h4.fw-bold.text-dark Return Asset
      div#alertBox.alert(style="display:none")
      form#returnForm
        .row.mb-3
          .col-md-6
            label.form-label Employee *
            select#employee.form-select(required)
              option(value="" disabled selected) Choose Employee
              each emp in employees
                option(value=emp.employee_id) #{emp.c_name}
          .col-md-6
            label.form-label Asset ID *
            select#asset.form-select(required)
              option(value="" disabled selected) Choose Asset
              each ast in assets
                option(value=ast.asset_id) #{ast.c_serial} - #{ast.c_type} (#{ast.c_branch})
        .row.mb-3
          .col-md-12
            label.form-label Reason *
            input#reason.form-control(type="text" required placeholder="Enter return reason")
        button.btn.btn-danger(type="submit") Return

  script.
    document.addEventListener('DOMContentLoaded', () => {
      const form      = document.getElementById('returnForm');
      const alertBox  = document.getElementById('alertBox');
      const employee  = document.getElementById('employee');
      const asset     = document.getElementById('asset');
      const reason    = document.getElementById('reason');

      function showMessage(msg, ok = true) {
        alertBox.style.display = 'block';
        alertBox.innerText = msg;
        alertBox.className = ok ? 'alert alert-success' : 'alert alert-danger';
      }

      form.addEventListener('submit', e => {
        e.preventDefault();

        const empId = employee.value;
        const assetId = asset.value;
        const r = reason.value.trim();

        if (!empId || !assetId || !r) {
          showMessage('All fields are required!', false);
          return;
        }

        fetch('/assets/return', {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({
            employee_id: empId,
            asset_id: assetId,
            reason: r
          })
        })
        .then(r => r.json())
        .then(d => {
          if (d.success) {
            showMessage('Asset returned successfully!', true);
            setTimeout(() => location.reload(), 1000);
          } else {
            showMessage('Error: ' + (d.error || 'Failed to return asset'), false);
          }
        })
        .catch(() => showMessage('Server error', false));
      });
    });
